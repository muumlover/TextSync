<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Text Sync</title>
    <script type="text/javascript" src="//cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
    <script type="text/javascript" src="//static.runoob.com/assets/qrcode/qrcode.min.js"></script>
</head>
<body>
<h1>Text sync addr:</h1>
<div id="url"></div>
<div id="qrcode" style="width:100px; height:100px; margin-top:15px;"></div>
<h1>Text sync from server:</h1>
<button id="send">发送</button>
<div id="response"></div>
<script type="text/javascript">
    console.log({{ sync_id|tojson }});
    const qrcode = new QRCode(document.getElementById("qrcode"), {
        width: 100,
        height: 100
    });

    function sseInit() {
        var evtSource = new EventSource("/sync/{{ sync_id }}");
        evtSource.onmessage = function (e) {
            document.getElementById('response').innerText =
                e.data + "\r\n" + document.getElementById('response').innerText;
        }
    }

    function initialize() {
        sseInit();
        qrcode.makeCode(window.location.href);
        document.getElementById('url').innerText = window.location.href
    }

    $('#send').on('click', function () {
        console.log({{ sync_id|tojson }});
        $.ajax("/send/{{ sync_id }}")
    });
    initialize();
</script>
</body>
</html>